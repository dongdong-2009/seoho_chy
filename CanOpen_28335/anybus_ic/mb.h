/*******************************************************************************
********************************************************************************
**
** File Name
** ---------
**
** MB.H
**
********************************************************************************
********************************************************************************
**
** Description
** -----------
** Header file for Modbus Protocol Driver
**
**
********************************************************************************
********************************************************************************
**
** Services List
** -------------
**
** Public Services:
**
**    MB_SetTimeout           -  Initiates the modbus protocol variables
**    MB_SendModbusMessage    -  Sends a Modbus message on the net
**
**
********************************************************************************
********************************************************************************
**                                                                            **
** COPYRIGHT NOTIFICATION (c) 1995,96,97,98,99 HMS Fieldbus Systems AB.       **
**                                                                            **
** This program is the property of HMS Fieldbus Systems AB.                   **
** It may not be reproduced, distributed, or used without permission          **
** of an authorised company official.                                         **
**                                                                            **
********************************************************************************
********************************************************************************
**
** Company: HMS Fieldbus Systems AB
**          Pilefeltsgatan 93-95
**          S-302 50  Halmstad
**          SWEDEN
**          Tel:     +46 (0)35 - 17 29 00
**          Fax:     +46 (0)35 - 17 29 09
**          e-mail:  info@hms.se
**
********************************************************************************
********************************************************************************
*/

/*******************************************************************************
********************************************************************************
**
** Change Log
** ----------
**
** Latest Revision:
**
**    Rev 0.10    13 jun 2002   Created
**    Rev 1.00    12 jul 2002   First Release
**
********************************************************************************
********************************************************************************
*/

#ifndef MB_H
#define MB_H



/*******************************************************************************
**
** Constants
**
********************************************************************************
*/

/*------------------------------------------------------------------------------
**
** MB_DEFAULT_TIMEOUT
**
** Defines the default timeout for response in uSec
**
**------------------------------------------------------------------------------
*/

#define MB_DEFAULT_TIMEOUT  500



/*******************************************************************************
**
** Public Globals
**
********************************************************************************
*/

/*------------------------------------------------------------------------------
**
** MB_bCRCCounter
**
**------------------------------------------------------------------------------
**
** Total number of crc error counter
**
**------------------------------------------------------------------------------
*/

extern UINT8 MB_bCRCCounter;


/*------------------------------------------------------------------------------
**
** MB_bTimeOutCounter
**
**------------------------------------------------------------------------------
**
** Total number of timeout error counter
**
**------------------------------------------------------------------------------
*/

extern UINT8 MB_bTimeOutCounter;


/*******************************************************************************
**
** Private Globals
**
********************************************************************************
*/

/*------------------------------------------------------------------------------
**
** MB_iTimeOutTime
**
**------------------------------------------------------------------------------
**
** Response timout time
**
**------------------------------------------------------------------------------
*/

extern UINT16 MB_iTimeOutTime;
extern UINT16 TM_iTimeOutTime;

#define SD_RX_BUFFER_SIZE     20

typedef struct sd_DataType
{

   BOOL fEnabled;
   UINT8 abRxBuffer[ SD_RX_BUFFER_SIZE ];
   UINT16 iRxGet;
   UINT16 iRxPut;
   UINT16 iRxSize;
   UINT16 iTxGet;

   UINT16 iTxSize;

}
sd_DataType;

extern sd_DataType sd_s;

void MB_SetTimeout( UINT16 iTime );
UCHAR MB_SendRecModbusMessage( UCHAR* pbData, UCHAR bSize, UCHAR* pbResponse );


#endif
